<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- iOS Safari -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<!-- Chrome, Firefox OS and Opera Status Bar Color -->
<meta name="theme-color" content="#FFFFFF">
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css">
<link rel="stylesheet" type="text/css"
  href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.19.0/themes/prism.min.css">
<link rel="stylesheet" type="text/css" href="css/SourceSansPro.css">
<link rel="stylesheet" type="text/css" href="css/theme.css">
<link rel="stylesheet" type="text/css" href="css/notablog.css">
<!-- Favicon -->

  <link rel="shortcut icon" href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F45b4de35-e668-4501-b8cd-711c64060c4e%2F5296676_ocean_sea_splash_surf_water_icon.png?table=collection&amp;id=6203be97-46d6-4bfc-9ce6-4457199ab784">

<style>
  :root {
    font-size: 20px;
  }
</style>
  <title>Bug Inside the ‘Apple Sample Apps Tutorial’&nbsp;|&nbsp;RadioHeadache</title>
  <meta property="og:type" content="blog">
  <meta property="og:title" content="Bug Inside the ‘Apple Sample Apps Tutorial’">
  
  
    <meta property="og:image" content="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;🐞&lt;/text&gt;&lt;/svg&gt;">
  
  <style>
    .DateTagBar {
      margin-top: 1.0rem;
    }
  </style>
</head>

<body>
  <nav class="Navbar">
  <a href="index.html">
    <div class="Navbar__Btn">
      
        <span><img class="inline-img-icon" src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F45b4de35-e668-4501-b8cd-711c64060c4e%2F5296676_ocean_sea_splash_surf_water_icon.png?table=collection&amp;id=6203be97-46d6-4bfc-9ce6-4457199ab784"></span>&nbsp;
      
      <span>Home</span>
    </div>
  </a>
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <span class="Navbar__Delim">&centerdot;</span>
      <a href="iOS-Dev-Articles.html">
        <div class="Navbar__Btn">
          
          <span>📱iOS Articles</span>
        </div>
      </a>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <span class="Navbar__Delim">&centerdot;</span>
      <a href="daily-logs.html">
        <div class="Navbar__Btn">
          
            <span><img class="inline-img-icon" src="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;🔖&lt;/text&gt;&lt;/svg&gt;"></span>&nbsp;
          
          <span>Daily Log</span>
        </div>
      </a>
    
  
    
      <span class="Navbar__Delim">&centerdot;</span>
      <a href="about.html">
        <div class="Navbar__Btn">
          
            <span><img class="inline-img-icon" src="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;😀&lt;/text&gt;&lt;/svg&gt;"></span>&nbsp;
          
          <span>About</span>
        </div>
      </a>
    
  
    
  
    
  
    
      <span class="Navbar__Delim">&centerdot;</span>
      <a href="newsletter.html">
        <div class="Navbar__Btn">
          
            <span><img class="inline-img-icon" src="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;📟&lt;/text&gt;&lt;/svg&gt;"></span>&nbsp;
          
          <span>Newsletter</span>
        </div>
      </a>
    
  
</nav>
  <header class="Header">
    
    <div class="Header__Spacer Header__Spacer--NoCover">
    </div>
    
      <div class="Header__Icon">
        <span><img class="inline-img-icon" src="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;🐞&lt;/text&gt;&lt;/svg&gt;"></span>
      </div>
    
    <h1 class="Header__Title">Bug Inside the ‘Apple Sample Apps Tutorial’</h1>
    
      <div class="DateTagBar">
        
          <span class="DateTagBar__Item DateTagBar__Date">Posted on Wed, Jan 5, 2022</span>
        
        
          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--red">
            <a href="tag/SwiftUI.html">SwiftUI</a>
          </span>
        
      </div>
    
  </header>
  <article id="https://www.notion.so/6e68dd6ecfaa411a915388c0ebc99463" class="PageRoot"><ul id="https://www.notion.so/7178582b8e6245d0924d205ea8724883" class="ColorfulBlock ColorfulBlock--ColorGray TableOfContents"><li class="TableOfContents__Item"><a href="#https://www.notion.so/fcb64e479f2d4beea90fbb9894202735"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">The Bug</span></span></div></a></li><li class="TableOfContents__Item"><a href="#https://www.notion.so/a459a128370447ed8f62b746329dbfad"><div style="margin-left:0px"><span class="SemanticStringArray"><span class="SemanticString">Why it happened?</span></span></div></a></li></ul><div id="https://www.notion.so/be1f0400fe1842e4a0c0358947de2036" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">When I was learning SwiftUI from Apple’s tutorial, I found a bug.</span></span></p></div><div id="https://www.notion.so/9c3a2d988e77413a9aa3f6a515e64ae1" class="Bookmark"><a href="https://developer.apple.com/tutorials/sample-apps/editinggrids"><h5 class="Bookmark__Title">Apple Developer Documentation</h5><p class="Bookmark__Link">https://developer.apple.com/tutorials/sample-apps/editinggrids</p></a></div><div id="https://www.notion.so/c0bc6dc77d4141e4a4f5e805bdbcdaa8" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">This app is a simple, contains two view: </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">My Symbols View</strong></span><span class="SemanticString"> and </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Symbol Picker View. </strong></span><span class="SemanticString">Tapping the ‘plus’ icon from the navigation bar will present the picker view, when you tap any icon in the picker view, the icon you selected will be added to your collection.</span></span></p></div><h1 id="https://www.notion.so/fcb64e479f2d4beea90fbb9894202735" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/fcb64e479f2d4beea90fbb9894202735"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">The Bug</span></span></h1><div id="https://www.notion.so/cf78ddfe0b14443499600e68e1b8fd07" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fac2ce783-6407-4a30-93b2-f4ef9bf2dd2c%2Fezgif-7-09dd53fdff.gif?width=400&amp;table=block&amp;id=cf78ddfe-0b14-4434-9960-0e68e1b8fd07"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fac2ce783-6407-4a30-93b2-f4ef9bf2dd2c%2Fezgif-7-09dd53fdff.gif?width=400&amp;table=block&amp;id=cf78ddfe-0b14-4434-9960-0e68e1b8fd07" style="width:400px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/c56bd9c86b834daea0913f851804d758" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">The problem is, </span></span></p></div><ol class="NumberedListWrapper"><li id="https://www.notion.so/86bd162df9ce4d929e8571d2f19cf18e" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">the collection to hold the selected icon is a mutable array, which accepts the icon’s name. Inside the </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">LazyVGrid</code></span><span class="SemanticString"> , it uses for each method to iterate the selected array, using array itself as id: </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">id: \.self</code></span><span class="SemanticString">, which means you can’t hold to identical icon name inside the array</span></span><pre id="https://www.notion.so/ffe41554bdc4482da4517336fa59db6a" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>ForEach&lt;Array&lt;String&gt;, String, ModifiedContent&lt;NavigationLink&lt;ModifiedContent&lt;ZStack&lt;TupleView&lt;(ModifiedContent&lt;ModifiedContent&lt;ModifiedContent&lt;ModifiedContent&lt;ModifiedContent&lt;Image, _AspectRatioLayout&gt;, _EnvironmentKeyWritingModifier&lt;Optional&lt;SymbolRenderingMode&gt;&gt;&gt;, _EnvironmentKeyWritingModifier&lt;Optional&lt;Color&gt;&gt;&gt;, _SafeAreaRegionsIgnoringLayout&gt;, _ClipEffect&lt;RoundedRectangle&gt;&gt;, Optional&lt;ModifiedContent&lt;Button&lt;ModifiedContent&lt;ModifiedContent&lt;ModifiedContent&lt;Image, _EnvironmentKeyWritingModifier&lt;Optional&lt;Font&gt;&gt;&gt;, _EnvironmentKeyWritingModifier&lt;Optional&lt;SymbolRenderingMode&gt;&gt;&gt;, _ForegroundStyleModifier2&lt;Color, Color&gt;&gt;&gt;, _OffsetEffect&gt;&gt;)&gt;&gt;, _PaddingLayout&gt;, ItemDetail&gt;, ButtonStyleModifier&lt;PlainButtonStyle&gt;&gt;&gt;: the ID house.fill occurs multiple times within the collection, this will give undefined results!
LazyVGridLayout: the ID house.fill is used by multiple child views, this will give undefined results!</span></span></span></code></pre></li><li id="https://www.notion.so/467ebb0b93cd4a478f33094cb48fb9ad" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">after you added an empty icon into the collection, you can still present the picker view, but when you add nothing but just pulling down to make the view dismiss, guess what, you will add an empty icon </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">AGAIN</strong></span><span class="SemanticString">! </span></span></li></ol><h1 id="https://www.notion.so/a459a128370447ed8f62b746329dbfad" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/a459a128370447ed8f62b746329dbfad"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Why it happened?</span></span></h1><div id="https://www.notion.so/96f3236ca5724cb2a193686280042a9e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Let’s dive into the code:</span></span></p></div><pre id="https://www.notion.so/04788b5e225a45ff8d2712a851f235eb" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>// The &#x27;My Symbol View&#x27;

struct SymbolGrid: View {

    @State private var isAddingSymbol = false
    @State private var isEditing = false

    private static let initialColumns = 3
    @State private var selectedSymbolName: String?
    @State private var numColumns = initialColumns
    @State private var gridColumns = Array(repeating: GridItem(.flexible()), count: initialColumns)
    
    @State private var symbolNames = [
        &quot;tshirt&quot;,
        &quot;eyes&quot;,
        &quot;eyebrow&quot;,
        &quot;nose&quot;,
        &quot;mustache&quot;,
        &quot;mouth&quot;,
        &quot;eyeglasses&quot;,
        &quot;facemask&quot;,
        &quot;brain.head.profile&quot;,
        &quot;brain&quot;,
        &quot;icloud&quot;,
        &quot;theatermasks.fill&quot;,
    ]
    
    var columnsText: String {
        numColumns &gt; 1 ? &quot;\(numColumns) Columns&quot; : &quot;1 Column&quot;
    }

    var body: some View {
        VStack {
            if isEditing {
                Stepper(columnsText, value: $numColumns, in: 1...6, step: 1) { _ in
                    withAnimation { gridColumns = Array(repeating: GridItem(.flexible()), count: numColumns) }
                }
                .padding()
            }

            ScrollView {
                LazyVGrid(columns: gridColumns) {
                    ForEach(symbolNames, id: \.self) { name in
                        NavigationLink(destination: ItemDetail(symbolName: name)) {
                            ZStack(alignment: .topTrailing) {
                                Image(systemName: name)
                                    .resizable()
                                    .scaledToFit()
                                    .symbolRenderingMode(.hierarchical)
                                    .foregroundColor(.accentColor)
                                    .ignoresSafeArea(.container, edges: .bottom)
                                    .cornerRadius(8)
                                
                                if isEditing {
                                    Button {
                                        guard let index = symbolNames.firstIndex(of: name) else { return }
                                        withAnimation {
                                            _ = symbolNames.remove(at: index)
                                        }
                                    } label: {
                                        Image(systemName: &quot;xmark.square.fill&quot;)
                                                    .font(Font.title)
                                                    .symbolRenderingMode(.palette)
                                                    .foregroundStyle(.white, Color.red)
                                    }
                                    .offset(x: 7, y: -7)
                                }
                            }
                            .padding()
                        }
                        .buttonStyle(.plain)
                    }
                }
            }
        }
        .navigationBarTitle(&quot;My Symbols&quot;)
        .navigationBarTitleDisplayMode(.inline)
        .sheet(isPresented: $isAddingSymbol, </span></span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><span>onDismiss: addSymbo</span></strong></span><span class="SemanticString"><span>l) {
            </span></span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><span>SymbolPicker(name: $selectedSymbolName)</span></strong></span><span class="SemanticString"><span>
        }
        .toolbar {
            ToolbarItem(placement: .navigationBarLeading) {
                Button(isEditing ? &quot;Done&quot; : &quot;Edit&quot;) {
                    withAnimation { isEditing.toggle() }
                }
            }
            ToolbarItem(placement: .navigationBarTrailing) {
                Button {
                    isAddingSymbol = true
                } label: {
                    Image(systemName: &quot;plus&quot;)
                }
                .disabled(isEditing)
            }
        }

    }
    
    </span></span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><span>func addSymbol() {
        guard let name = selectedSymbolName else { return }
//        if symbolNames.contains(name) {
//            return
//        }
        withAnimation {
            symbolNames.insert(name, at: 0)
        }
    }</span></strong></span><span class="SemanticString"><span>
}</span></span></span></code></pre><pre id="https://www.notion.so/843fa75db1114a33baaacb6bb60e9808" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>// The &#x27;Symbol Picker View&#x27;
struct SymbolPicker: View {
    @Environment(\.presentationMode) var presentationMode
    @Binding var name: String?

    let columns = Array(repeating: GridItem(.flexible()), count: 4)

    let pickableItems = [
        &quot;house.fill&quot;,
        &quot;sun.max.fill&quot;,
        &quot;cloud.rain.fill&quot;,
        &quot;pawprint.fill&quot;,
        &quot;lungs.fill&quot;,
        &quot;face.smiling&quot;,
        &quot;gear&quot;,
        &quot;allergens&quot;,
        &quot;bolt.heart&quot;,
        &quot;ladybug.fill&quot;,
        &quot;bus.fill&quot;,
        &quot;bicycle.circle&quot;,
        &quot;faceid&quot;,
        &quot;gamecontroller.fill&quot;,
        &quot;timer&quot;,
        &quot;eye.fill&quot;,
        &quot;person.icloud&quot;,
        &quot;tortoise.fill&quot;,
        &quot;hare.fill&quot;,
        &quot;leaf.fill&quot;,
        &quot;wand.and.stars&quot;,
        &quot;globe.americas.fill&quot;,
        &quot;globe.europe.africa.fill&quot;,
        &quot;globe.asia.australia.fill&quot;,
        &quot;hands.sparkles.fill&quot;,
        &quot;hand.draw.fill&quot;,
        &quot;waveform.path.ecg.rectangle.fill&quot;,
        &quot;gyroscope&quot;,
        
    ]

    var body: some View {
        ScrollView {
            LazyVGrid(columns: columns) {
                ForEach(pickableItems, id: \.self) { item in
                    Button {
                        </span></span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><span>self.name = item</span></strong></span><span class="SemanticString"><span>
                        presentationMode.wrappedValue.dismiss()
                    } label: {
                        Image(systemName: item)
                            .resizable()
                            .scaledToFit()
                            .symbolRenderingMode(.hierarchical)
                            .foregroundColor(.accentColor)
                            .ignoresSafeArea(.container, edges: .bottom)
                    }
                    .padding()
                    .buttonStyle(.plain)
                }
            }
        }
    }
}</span></span></span></code></pre><div id="https://www.notion.so/9af39b95a4484782a0409d451034c34d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">As we can see from above, </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">SymbolGrid</code></span><span class="SemanticString"> uses a binding object to hold the selected icon’s name, after picking the icon, the param </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">@State private var selectedSymbolName: String?</code></span><span class="SemanticString"> will be modified and change to the name you picked. </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">selectedSymbolName</code></span><span class="SemanticString">  will be empty when initialized, but when you pick an icon for the first time, it will automatically changed to the latest icon’s name that you pick, until you pick another one. So when you pick an icon once, then you pull down and not picking any icon for the second time, the </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">selectedSymbolName</code></span><span class="SemanticString"> will still be the same, and when dismissed, function </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">addSymbom()</code></span><span class="SemanticString"> is call and an empty icon will be added.</span></span></p></div><div id="https://www.notion.so/b177599fc29b44d282b008b429373aa0" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div></article>
  <footer class="Footer">
  <div>&copy; RadioHeadache 2019-2021</div>
  <div>&centerdot;</div>
  <div>Powered by <a href="https://github.com/dragonman225/notablog" target="_blank"
      rel="noopener noreferrer">Notablog</a>.
  </div>
</footer>
</body>

</html>